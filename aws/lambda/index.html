<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.2.4"><title>Lambda - Cloud Custodian Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.f7f47774.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../_static/css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=yellow data-md-color-accent=deep-orange> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#lambda-support-lambda class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Cloud Custodian Documentation" class="md-header__button md-logo" aria-label="Cloud Custodian Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Cloud Custodian Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Lambda </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=yellow data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=yellow data-md-color-accent=pink aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../actions/ class=md-tabs__link> Actions </a> </li> <li class=md-tabs__item> <a href=../../contribute/ class=md-tabs__link> Contribute </a> </li> <li class=md-tabs__item> <a href=../../deployment/ class=md-tabs__link> Deployment </a> </li> <li class=md-tabs__item> <a href=../../filters/ class=md-tabs__link> Filters </a> </li> <li class=md-tabs__item> <a href=../contribute/ class="md-tabs__link md-tabs__link--active"> Aws </a> </li> <li class=md-tabs__item> <a href=../../azure/gettingstarted/ class=md-tabs__link> Azure </a> </li> <li class=md-tabs__item> <a href=../../developer/ class=md-tabs__link> Developer </a> </li> <li class=md-tabs__item> <a href=../../gcp/contribute/ class=md-tabs__link> Gcp </a> </li> <li class=md-tabs__item> <a href=../../quickstart/ class=md-tabs__link> Quickstart </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Cloud Custodian Documentation" class="md-nav__button md-logo" aria-label="Cloud Custodian Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Cloud Custodian Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../actions/ class=md-nav__link> Actions </a> </li> <li class=md-nav__item> <a href=../../contribute/ class=md-nav__link> Contribute </a> </li> <li class=md-nav__item> <a href=../../deployment/ class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=../../filters/ class=md-nav__link> Filters </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Aws <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Aws data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Aws </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../contribute/ class=md-nav__link> Contribute </a> </li> <li class=md-nav__item> <a href=../gettingstarted/ class=md-nav__link> Gettingstarted </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> Lambda </a> </li> <li class=md-nav__item> <a href=../usage/ class=md-nav__link> Usage </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_5 type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=2> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../examples/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../examples/accountinvalidiplogin/ class=md-nav__link> Accountinvalidiplogin </a> </li> <li class=md-nav__item> <a href=../examples/accountrootlogin/ class=md-nav__link> Accountrootlogin </a> </li> <li class=md-nav__item> <a href=../examples/accountservicelimit/ class=md-nav__link> Accountservicelimit </a> </li> <li class=md-nav__item> <a href=../examples/amicomp/ class=md-nav__link> Amicomp </a> </li> <li class=md-nav__item> <a href=../examples/asginvalidconfig/ class=md-nav__link> Asginvalidconfig </a> </li> <li class=md-nav__item> <a href=../examples/asgnotused/ class=md-nav__link> Asgnotused </a> </li> <li class=md-nav__item> <a href=../examples/asgoffhours/ class=md-nav__link> Asgoffhours </a> </li> <li class=md-nav__item> <a href=../examples/blocknonstandardregionresources/ class=md-nav__link> Blocknonstandardregionresources </a> </li> <li class=md-nav__item> <a href=../examples/dmsenforcessl/ class=md-nav__link> Dmsenforcessl </a> </li> <li class=md-nav__item> <a href=../examples/ebsgarbagecollect/ class=md-nav__link> Ebsgarbagecollect </a> </li> <li class=md-nav__item> <a href=../examples/ebssnapshots/ class=md-nav__link> Ebssnapshots </a> </li> <li class=md-nav__item> <a href=../examples/ebsunencrypted/ class=md-nav__link> Ebsunencrypted </a> </li> <li class=md-nav__item> <a href=../examples/ec2-auto-tag-user/ class=md-nav__link> Ec2 auto tag user </a> </li> <li class=md-nav__item> <a href=../examples/ec2offhours/ class=md-nav__link> Ec2offhours </a> </li> <li class=md-nav__item> <a href=../examples/ec2oldinstances/ class=md-nav__link> Ec2oldinstances </a> </li> <li class=md-nav__item> <a href=../examples/ec2poweronstoppedforpatching/ class=md-nav__link> Ec2poweronstoppedforpatching </a> </li> <li class=md-nav__item> <a href=../examples/ec2unpatchedworkflow/ class=md-nav__link> Ec2unpatchedworkflow </a> </li> <li class=md-nav__item> <a href=../examples/eipgarbagecollect/ class=md-nav__link> Eipgarbagecollect </a> </li> <li class=md-nav__item> <a href=../examples/elbdeleteinetfacing/ class=md-nav__link> Elbdeleteinetfacing </a> </li> <li class=md-nav__item> <a href=../examples/elbgarbagecollection/ class=md-nav__link> Elbgarbagecollection </a> </li> <li class=md-nav__item> <a href=../examples/elbsslblacklist/ class=md-nav__link> Elbsslblacklist </a> </li> <li class=md-nav__item> <a href=../examples/elbsslwhitelist/ class=md-nav__link> Elbsslwhitelist </a> </li> <li class=md-nav__item> <a href=../examples/iamsetrolepolicy/ class=md-nav__link> Iamsetrolepolicy </a> </li> <li class=md-nav__item> <a href=../examples/lambdaerrorsnotify/ class=md-nav__link> Lambdaerrorsnotify </a> </li> <li class=md-nav__item> <a href=../examples/offhours/ class=md-nav__link> Offhours </a> </li> <li class=md-nav__item> <a href=../examples/rdsdeleteunused/ class=md-nav__link> Rdsdeleteunused </a> </li> <li class=md-nav__item> <a href=../examples/rdspublicunencrypted/ class=md-nav__link> Rdspublicunencrypted </a> </li> <li class=md-nav__item> <a href=../examples/s3configurenewbucket/ class=md-nav__link> S3configurenewbucket </a> </li> <li class=md-nav__item> <a href=../examples/s3denypublicobjectacls/ class=md-nav__link> S3denypublicobjectacls </a> </li> <li class=md-nav__item> <a href=../examples/s3encryption/ class=md-nav__link> S3encryption </a> </li> <li class=md-nav__item> <a href=../examples/s3globalgrants/ class=md-nav__link> S3globalgrants </a> </li> <li class=md-nav__item> <a href=../examples/sagemakernotebookdeletepublicorunencrypted/ class=md-nav__link> Sagemakernotebookdeletepublicorunencrypted </a> </li> <li class=md-nav__item> <a href=../examples/securitygroupsaddpermission/ class=md-nav__link> Securitygroupsaddpermission </a> </li> <li class=md-nav__item> <a href=../examples/securitygroupsdetectremediate/ class=md-nav__link> Securitygroupsdetectremediate </a> </li> <li class=md-nav__item> <a href=../examples/tagcompliance/ class=md-nav__link> Tagcompliance </a> </li> <li class=md-nav__item> <a href=../examples/vpcflowlog/ class=md-nav__link> Vpcflowlog </a> </li> <li class=md-nav__item> <a href=../examples/vpcpeeringcrossaccount/ class=md-nav__link> Vpcpeeringcrossaccount </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_6 type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=2> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../topics/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../topics/config/ class=md-nav__link> Config </a> </li> <li class=md-nav__item> <a href=../topics/securityhub/ class=md-nav__link> Securityhub </a> </li> <li class=md-nav__item> <a href=../topics/ssm/ class=md-nav__link> Ssm </a> </li> <li class=md-nav__item> <a href=../topics/xray/ class=md-nav__link> Xray </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Azure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Azure data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../azure/gettingstarted/ class=md-nav__link> Gettingstarted </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_2 type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2> Advanced <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Advanced data-md-level=2> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../azure/advanced/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../azure/advanced/azurepolicy/ class=md-nav__link> Azurepolicy </a> </li> <li class=md-nav__item> <a href=../../azure/advanced/contribute/ class=md-nav__link> Contribute </a> </li> <li class=md-nav__item> <a href=../../azure/advanced/multiplesubs/ class=md-nav__link> Multiplesubs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_3 type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3> Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Configuration data-md-level=2> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../azure/configuration/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../azure/configuration/acitutorial/ class=md-nav__link> Acitutorial </a> </li> <li class=md-nav__item> <a href=../../azure/configuration/authentication/ class=md-nav__link> Authentication </a> </li> <li class=md-nav__item> <a href=../../azure/configuration/containerhosting/ class=md-nav__link> Containerhosting </a> </li> <li class=md-nav__item> <a href=../../azure/configuration/functionshosting/ class=md-nav__link> Functionshosting </a> </li> <li class=md-nav__item> <a href=../../azure/configuration/helmtutorial/ class=md-nav__link> Helmtutorial </a> </li> <li class=md-nav__item> <a href=../../azure/configuration/monitoring/ class=md-nav__link> Monitoring </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4 type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=2> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../azure/examples/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../azure/examples/appservicecors-compute/ class=md-nav__link> Appservicecors compute </a> </li> <li class=md-nav__item> <a href=../../azure/examples/appserviceplansresize-compute/ class=md-nav__link> Appserviceplansresize compute </a> </li> <li class=md-nav__item> <a href=../../azure/examples/cosmosdb-collection-on-off-hours-databases/ class=md-nav__link> Cosmosdb collection on off hours databases </a> </li> <li class=md-nav__item> <a href=../../azure/examples/emailnotify-notifications/ class=md-nav__link> Emailnotify notifications </a> </li> <li class=md-nav__item> <a href=../../azure/examples/firewall-cosmosaction-networking/ class=md-nav__link> Firewall cosmosaction networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/firewall-rulesfiltering-networking/ class=md-nav__link> Firewall rulesfiltering networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/loadbalancerfilterbyfrotendip-networking/ class=md-nav__link> Loadbalancerfilterbyfrotendip networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/metrics-general/ class=md-nav__link> Metrics general </a> </li> <li class=md-nav__item> <a href=../../azure/examples/networksecuritygroups-networking/ class=md-nav__link> Networksecuritygroups networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/resourcegroupsdelayedoperation-general/ class=md-nav__link> Resourcegroupsdelayedoperation general </a> </li> <li class=md-nav__item> <a href=../../azure/examples/resourcegroupsorphanresources-general-compute-networking/ class=md-nav__link> Resourcegroupsorphanresources general compute networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/resourcegroupsremoveempty-general/ class=md-nav__link> Resourcegroupsremoveempty general </a> </li> <li class=md-nav__item> <a href=../../azure/examples/routetablewithsubnet-networking/ class=md-nav__link> Routetablewithsubnet networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/sqldatabasebackupretention-databases/ class=md-nav__link> Sqldatabasebackupretention databases </a> </li> <li class=md-nav__item> <a href=../../azure/examples/sqldatabaseupdateretentionpolicies-databases/ class=md-nav__link> Sqldatabaseupdateretentionpolicies databases </a> </li> <li class=md-nav__item> <a href=../../azure/examples/sqldatabasewithpremiumsku-databases/ class=md-nav__link> Sqldatabasewithpremiumsku databases </a> </li> <li class=md-nav__item> <a href=../../azure/examples/storageaddfirewallrulestostorage-databases-networking/ class=md-nav__link> Storageaddfirewallrulestostorage databases networking </a> </li> <li class=md-nav__item> <a href=../../azure/examples/storageblockpublicaccess-networking-databases/ class=md-nav__link> Storageblockpublicaccess networking databases </a> </li> <li class=md-nav__item> <a href=../../azure/examples/storagecontainerevent-databases/ class=md-nav__link> Storagecontainerevent databases </a> </li> <li class=md-nav__item> <a href=../../azure/examples/tagadd-general-compute/ class=md-nav__link> Tagadd general compute </a> </li> <li class=md-nav__item> <a href=../../azure/examples/tagautotagusers-general-identity/ class=md-nav__link> Tagautotagusers general identity </a> </li> <li class=md-nav__item> <a href=../../azure/examples/tagremove-general-compute/ class=md-nav__link> Tagremove general compute </a> </li> <li class=md-nav__item> <a href=../../azure/examples/tagtrim-general-compute/ class=md-nav__link> Tagtrim general compute </a> </li> <li class=md-nav__item> <a href=../../azure/examples/teamsnewresourcegroup-general-notifications/ class=md-nav__link> Teamsnewresourcegroup general notifications </a> </li> <li class=md-nav__item> <a href=../../azure/examples/virtualmachinesstoppedvm-compute/ class=md-nav__link> Virtualmachinesstoppedvm compute </a> </li> <li class=md-nav__item> <a href=../../azure/examples/virtualmachineswithpublicip-compute-networking/ class=md-nav__link> Virtualmachineswithpublicip compute networking </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4_28 type=checkbox id=__nav_7_4_28> <label class=md-nav__link for=__nav_7_4_28> Logicappnotifications <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Logicappnotifications data-md-level=3> <label class=md-nav__title for=__nav_7_4_28> <span class="md-nav__icon md-icon"></span> Logicappnotifications </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../azure/examples/logicappnotifications/logicappnotification/ class=md-nav__link> Logicappnotification </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Developer <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Developer data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Developer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../developer/documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../developer/installing/ class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=../../developer/packaging/ class=md-nav__link> Packaging </a> </li> <li class=md-nav__item> <a href=../../developer/tests/ class=md-nav__link> Tests </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Gcp <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Gcp data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Gcp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gcp/contribute/ class=md-nav__link> Contribute </a> </li> <li class=md-nav__item> <a href=../../gcp/gettingstarted/ class=md-nav__link> Gettingstarted </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_3 type=checkbox id=__nav_9_3> <label class=md-nav__link for=__nav_9_3> Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Examples data-md-level=2> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gcp/examples/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/appengine-certificates/ class=md-nav__link> Appengine certificates </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/appengine-domain/ class=md-nav__link> Appengine domain </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/appengine-firewall-ingress-rule/ class=md-nav__link> Appengine firewall ingress rule </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/dataflow-job/ class=md-nav__link> Dataflow job </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/dm-deployments/ class=md-nav__link> Dm deployments </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/dns-managed-zone/ class=md-nav__link> Dns managed zone </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/dns-policy/ class=md-nav__link> Dns policy </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/gce-autoscaler/ class=md-nav__link> Gce autoscaler </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/gce-instance-template/ class=md-nav__link> Gce instance template </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/kms-cryptokey/ class=md-nav__link> Kms cryptokey </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/loadbalancer-delete-backend-buckets/ class=md-nav__link> Loadbalancer delete backend buckets </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/loadbalancer-network-tiers/ class=md-nav__link> Loadbalancer network tiers </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/loadbalancer-ssl-policy-delete-old-versions/ class=md-nav__link> Loadbalancer ssl policy delete old versions </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/pubsub-snapshots/ class=md-nav__link> Pubsub snapshots </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/pubsub-subscriptions/ class=md-nav__link> Pubsub subscriptions </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/spanner-drop-databases/ class=md-nav__link> Spanner drop databases </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/spanner-reduce-instances-count/ class=md-nav__link> Spanner reduce instances count </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/spanner-set-iam-policy/ class=md-nav__link> Spanner set iam policy </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/sql-backupruns/ class=md-nav__link> Sql backupruns </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/sql-instance/ class=md-nav__link> Sql instance </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/sql-sslcerts/ class=md-nav__link> Sql sslcerts </a> </li> <li class=md-nav__item> <a href=../../gcp/examples/sql-users/ class=md-nav__link> Sql users </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_4 type=checkbox id=__nav_9_4> <label class=md-nav__link for=__nav_9_4> Policy <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Policy data-md-level=2> <label class=md-nav__title for=__nav_9_4> <span class="md-nav__icon md-icon"></span> Policy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gcp/policy/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../gcp/policy/genericgcpactions/ class=md-nav__link> Genericgcpactions </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_4_3 type=checkbox id=__nav_9_4_3> <label class=md-nav__link for=__nav_9_4_3> Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Resources data-md-level=3> <label class=md-nav__title for=__nav_9_4_3> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gcp/policy/resources/loadbalancer/ class=md-nav__link> Loadbalancer </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10> Quickstart <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Quickstart data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Quickstart </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quickstart/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../quickstart/advanced/ class=md-nav__link> Advanced </a> </li> <li class=md-nav__item> <a href=../../quickstart/policyStructure/ class=md-nav__link> policyStructure </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=lambda-support-lambda>Lambda Support {#lambda}<a class=headerlink href=#lambda-support-lambda title="Permanent link">&para;</a></h1> <p>Lambda provides for powerful realtime event based code execution in response to infrastructure and application behavior. A number of different Amazon services can be used as event sources.</p> <h2 id=cloudwatch-events>CloudWatch Events<a class=headerlink href=#cloudwatch-events title="Permanent link">&para;</a></h2> <p><a href=http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html>CloudWatch Events</a> (CWE) is a general event bus for AWS infrastructure. Currently, it covers several major sources of information:</p> <ol> <li>CloudTrail API calls over a poll period on CloudTrail delivery,</li> <li>real-time instance status events,</li> <li>autoscale group notifications, and</li> <li>scheduled/periodic events.</li> </ol> <p>CloudTrail provides a very rich data source over the entire range of AWS services exposed via the audit trail that allows Custodian to define effective realtime policies against any AWS product. Additionally, for EC2 instances we can provide mandatory policy compliance - this means the non-compliant resources never became available.</p> <h3 id=cloud-custodian-integration>Cloud Custodian Integration<a class=headerlink href=#cloud-custodian-integration title="Permanent link">&para;</a></h3> <p>Custodian provides for policy level execution against any CWE event stream. Each Custodian policy can be deployed as an independent Lambda function. The only difference between a Custodian policy that runs in Lambda and one that runs directly from the CLI in poll mode is the specification of the subscription of the events in the mode config block of the policy.</p> <p>Internally Custodian will reconstitute current state for all the resources in the event, execute the policy against them, match against the policy filters, and apply the policy actions to matching resources.</p> <h4 id=cloudtrail-api-calls>CloudTrail API Calls<a class=headerlink href=#cloudtrail-api-calls title="Permanent link">&para;</a></h4> <p>Lambdas can receive CWE over CloudTrail API calls with delay of 90s at P99.</p> <div class=highlight><pre><span></span><code><span class=nt>policies</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-tag-running</span>
    <span class=nt>resource</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class=nt>mode</span><span class=p>:</span>
      <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
      <span class=nt>events</span><span class=p>:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">RunInstances</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mark</span>
        <span class=nt>tag</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">foo</span>
        <span class=nt>msg</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bar</span>
</code></pre></div> <p>Because the total AWS API surface area is so large most CloudTrail API event subscriptions need two additional fields:</p> <ol> <li>For CloudTrail events we need to reference the source API call.</li> <li>To work transparently with existing resource policies, we also need to specify how to extract the resource IDs from the event via JMESPath so that the resources can be queried.</li> </ol> <p>For very common API calls for policies, some <a href=https://github.com/cloud-custodian/cloud-custodian/blob/master/c7n/cwe.py#L28-L69>shortcuts</a> have been defined to allow for easier policy writing as for the <code>RunInstances</code> API call above, which expands to:</p> <div class=highlight><pre><span></span><code><span class=nt>events</span><span class=p>:</span>
 <span class="p p-Indicator">-</span> <span class=nt>source</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2.amazonaws.com</span>
   <span class=nt>event</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">RunInstances</span>
   <span class=nt>ids</span><span class=p>:</span> <span class=s>&quot;responseElements.instancesSet.items[].instanceId&quot;</span>
</code></pre></div> <h4 id=ec2-instance-state-events>EC2 Instance State Events<a class=headerlink href=#ec2-instance-state-events title="Permanent link">&para;</a></h4> <p>Lambdas can receive EC2 instance state events in real time (seconds delay).</p> <div class=highlight><pre><span></span><code><span class=nt>policies</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-require-encrypted-volumes</span>
    <span class=nt>resource</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class=nt>mode</span><span class=p>:</span>
      <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-instance-state</span>
      <span class=nt>events</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pending</span>
    <span class=nt>filters</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ebs</span>
        <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Encrypted</span>
        <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mark</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">terminate</span>
</code></pre></div> <h4 id=periodic-function>Periodic Function<a class=headerlink href=#periodic-function title="Permanent link">&para;</a></h4> <p>We support both rate per unit time and cron expressions, per <a href=http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html>scheduler syntax</a>.</p> <p>When using --assume on the custodian run cli command, the specified role is also considered as the execution role to be attached to lambda function that gets deployed. In such scenario it is not required to specify the role attribute in the config block for mode. However, if you are not using the --assume option, then it is required to add role in the config-block of mode. When specifying role {account_id} is runtime substituted so a policy can be used across accounts.</p> <div class=highlight><pre><span></span><code><span class=nt>policies</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">s3-bucket-check</span>
    <span class=nt>resource</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">s3</span>
    <span class=nt>mode</span><span class=p>:</span>
      <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">periodic</span>
      <span class=nt>schedule</span><span class=p>:</span> <span class=s>&quot;rate(1</span><span class=nv> </span><span class=s>day)&quot;</span>
      <span class=nt>role</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::{account_id}:role/some-role</span>
</code></pre></div> <h4 id=event-pattern-filtering>Event Pattern Filtering<a class=headerlink href=#event-pattern-filtering title="Permanent link">&para;</a></h4> <p>Cloud Watch Events also support content/pattern filtering, see</p> <ul> <li><a href=https://docs.aws.amazon.com/eventbridge/latest/userguide/content-filtering-with-event-patterns.html>https://docs.aws.amazon.com/eventbridge/latest/userguide/content-filtering-with-event-patterns.html</a></li> <li><a href=https://aws.amazon.com/blogs/compute/reducing-custom-code-by-using-advanced-rules-in-amazon-eventbridge/ >https://aws.amazon.com/blogs/compute/reducing-custom-code-by-using-advanced-rules-in-amazon-eventbridge/</a></li> </ul> <p>In the context of a custodian policy you can define a \'pattern\' key under mode, the pattern will be merged with the custodian generated default event pattern.</p> <p>If the pattern filtering does not match the event, the custodian policy lambda will not be invoked/executed.</p> <p>In the following example policy, an additional event pattern is supplied that ignores any create subnet call by the iam user named [deputy]{.title-ref}.</p> <div class=highlight><pre><span></span><code><span class=nt>policies</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">subnet-detect</span>
    <span class=nt>resource</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aws.subnet</span>
    <span class=nt>mode</span><span class=p>:</span>
      <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
      <span class=nt>role</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CustodianDemoRole</span>
      <span class=nt>events</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>source</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2.amazonaws.com</span>
          <span class=nt>event</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CreateSubnet</span>
          <span class=nt>ids</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">responseElements.subnet.subnetId</span>
      <span class=nt>pattern</span><span class=p>:</span>
        <span class=nt>detail</span><span class=p>:</span>
          <span class=nt>userIdentity</span><span class=p>:</span>
            <span class=nt>userName</span><span class=p>:</span> <span class="p p-Indicator">[{</span><span class=s>&#39;anything-but&#39;</span><span class="p p-Indicator">:</span> <span class=s>&#39;deputy&#39;</span><span class="p p-Indicator">}]</span>
</code></pre></div> <h2 id=config-rules>Config Rules<a class=headerlink href=#config-rules title="Permanent link">&para;</a></h2> <p><a href=http://docs.aws.amazon.com/config/latest/developerguide/evaluate-config_develop-rules.html>AWS Config rules</a> allow you to invoke logic in response to configuration changes in your AWS environment, and Cloud Custodian is the easiest way to write and provision Config rules. Delay here is typically 1-15m (though the SLA on tag-only changes is a bit higher).</p> <p>In this section we\'ll look at how we would deploy the <code>quickstart &lt;quickstart&gt;</code>{.interpreted-text role="ref"} example using Config. Before you proceed, make sure you\'ve removed the <code>Custodian</code> tag from any EC2 instance left over from the quickstart.</p> <p>First, modify <code>custodian.yml</code> to specify a mode type of <code>config-rule</code>. You\'ll also need the ARN of an IAM role to assume when running the Lambda that Custodian is going to install for you. Sensible policies to add to that role would be <code>AWSLambdaBasicExecutionRole</code> and <code>AWSConfigRulesExecutionRole</code>, on top of any permissions your lambda is going to need to perform the actions you want it to perform.</p> <div class=highlight><pre><span></span><code><span class=nt>policies</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-first-policy</span>
    <span class=nt>mode</span><span class=p>:</span>
        <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">config-rule</span>
        <span class=nt>role</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::123456789012:role/some-role</span>
    <span class=nt>resource</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class=nt>filters</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;tag:Custodian&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>
</code></pre></div> <p>Then make sure that you\'ve set up AWS Config. If you <a href=https://eu-west-1.console.aws.amazon.com/config/home>go to the AWS Config console</a> and see the welcome screen instead of the dashboard, go through <a href=https://docs.aws.amazon.com/config/latest/developerguide/gs-console.html>the setup procedure first</a>.</p> <p>Now deploy the policy:</p> <div class=highlight><pre><span></span><code>custodian run -s . custodian.yml
</code></pre></div> <p>That should give you log output like this:</p> <div class=codehilite><pre><span></span><code>2017-01-25 05:43:01,539: custodian.policy:INFO Provisioning policy lambda my-first-policy
2017-01-25 05:43:04,683: custodian.lambda:INFO Publishing custodian policy lambda function custodian-my-first-policy
</code></pre></div> <p>Go check the AWS console to see the Lambda as well as the Config rule that Custodian created. The Config rule should be listed as \"Compliant\" or \"No results reported\" (if not, be sure you removed the <code>Custodian</code> tag from any instance left over from the quickstart).</p> <p>Now for the fun part! With your new policy installed, go ahead and create an EC2 instance with a <code>Custodian</code> tag (any non-empty value), and wait (events from Config are effectively delayed 15m up to 6hrs on tag changes). If all goes well, you should eventually see that your new custom Config rule notices the EC2 instance with the <code>Custodian</code> tag, and stops it according to your policy.</p> <p>Congratulations! You have now installed your policy to run under Config rather than from your command line.</p> <h2 id=lambda-configuration>Lambda Configuration<a class=headerlink href=#lambda-configuration title="Permanent link">&para;</a></h2> <p>Custodian lambdas support configuring all lambda options via keys on the lambda mode in the YAML. See AWS\' <a href=https://docs.aws.amazon.com/lambda/latest/dg/resource-model.html>AWS Lambda Function Configuration</a> page for the full list of configuration options available on a Lambda.</p> <p>Refer to <code>aws_modes</code>{.interpreted-text role="ref"} for detailed explanation of the different <code>type</code> values and the corresponding additional configuration options each requires.</p> <p>Here is an example YAML fragment that shows the options you are most likely to want or need to configure on a lambda:</p> <div class=highlight><pre><span></span><code><span class=nt>mode</span><span class=p>:</span>
  <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
  <span class=nt>events</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CreateBucket</span>

  <span class=c1>##### ROLE #####</span>
  <span class=c1># Specify the ARN role as either name or full ARN.  This shows</span>
  <span class=c1># us running the lambda with the IAM role named Custodian.</span>
  <span class=c1># Specifying role by name:</span>
  <span class=nt>role</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Custodian</span>
  <span class=c1># Or specifying using a full ARN</span>
  <span class=c1># role: arn:aws:iam::123456789012:role/Custodian</span>

  <span class=c1>##### TAGS #####</span>
  <span class=c1># Specify the tags to assign to this Lambda.  We are setting a</span>
  <span class=c1># tag named &quot;Application&quot; with a value of &quot;Custodian&quot;, and a</span>
  <span class=c1># &quot;CreatedBy&quot; tag with a value of &quot;CloudCustodian&quot;.</span>
  <span class=nt>tags</span><span class=p>:</span>
    <span class=nt>Application</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Custodian</span>
    <span class=nt>CreatedBy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">CloudCustodian</span>
</code></pre></div> <h2 id=execution-options>Execution Options<a class=headerlink href=#execution-options title="Permanent link">&para;</a></h2> <p>When running in Lambda you may want policy execution to run using particular options corresponding to those passed to the custodian CLI.</p> <p>Execution in lambda comes with a default set of configuration which is different from the defaults you might set when running through the command line:</p> <ul> <li>Metrics are enabled</li> <li>Output dir is set to a random /tmp/ directory</li> <li>Caching of AWS resource state is disabled</li> <li>Account ID is automatically set with info from sts</li> <li>Region is automatically set to the region of the lambda (using the AWS_DEFAULT_REGION environment variable in lambda)</li> </ul> <p>When you want to override these settings, you must set \'execution-options\' with one of the following keys:</p> <ul> <li>region</li> <li>cache</li> <li>profile</li> <li>account_id</li> <li>assume_role</li> <li>log_group</li> <li>metrics</li> <li>output_dir</li> <li>cache_period</li> <li>dryrun</li> </ul> <p>One useful thing we can do with these options is to make a policy execute in a different account using assume_role. A policy definition for this looks like:</p> <div class=highlight><pre><span></span><code><span class=nt>policies</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">my-first-policy-cross-account</span>
    <span class=nt>mode</span><span class=p>:</span>
        <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">periodic</span>
        <span class=nt>schedule</span><span class=p>:</span> <span class=s>&quot;rate(1</span><span class=nv> </span><span class=s>day)&quot;</span>
        <span class=nt>role</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::123456789012:role/lambda-role</span>
        <span class=nt>execution-options</span><span class=p>:</span>
          <span class=nt>assume_role</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:iam::210987654321:role/target-role</span>
          <span class=nt>metrics</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aws</span>
    <span class=nt>resource</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
    <span class=nt>filters</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=s>&quot;tag:Custodian&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class=nt>actions</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">stop</span>
</code></pre></div> <p>A couple of things to note here:</p> <ol> <li>Metrics are pushed using the assumed role which may or may not be desired</li> <li> <p>The mode must be periodic as there are restrictions on where policy executions can run according to the mode:</p> <p>Config</p> <p>: May run in a different region but not cross-account</p> <p>Event</p> <p>: Only run in the same region and account</p> <p>Periodic</p> <p>: May run in a different region and different account</p> </li> </ol> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2021-08-23 19:02:35</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../gettingstarted/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Gettingstarted" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Gettingstarted </div> </div> </a> <a href=../usage/ class="md-footer__link md-footer__link--next" aria-label="Next: Usage" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Usage </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2021 The Cloud Custodian Authors </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "tabs", "instant", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.febc23d1.min.js></script> </body> </html>